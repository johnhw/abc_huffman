#include <stdlib.h>
#include <stdint.h>
#include <math.h>
#include "music_data.h"
#define A440 69

/* Note offset strings, for keys and chords */
note_offset note_offsets[] = {
    {"C", 0},
    {"Cs", 1},
    {"Db", 1},
    {"D", 2},
    {"Ds", 3},
    {"Eb", 3},
    {"E", 4},
    {"F", 5},
    {"Fs", 6},
    {"Gb", 6},
    {"G", 7},
    {"Gs", 8},
    {"Ab", 8},
    {"A", 9},
    {"As", 10},
    {"Bb", 10},
    {"B", 11},    
    {NULL, 0},
};

uint32_t midi_to_hz(uint8_t note)
{
    /* Convert a MIDI note number to a frequency in Hz */
    return (uint32_t)(440.0*pow(2, (note-A440)/12.0));
}


/* Chord types */
chord_type chord_types[] = {
    {"maj", {0, 4, 7, 11, -1}},
    {"min", {0, 3, 7, 10, -1}},
    {"dim", {0, 3, 6, 9, -1}},
    {"aug", {0, 4, 8, 12, -1}},
    {"maj7", {0, 4, 7, 11, 14}},
    {"min7", {0, 3, 7, 10, 14}},
    {"7", {0, 4, 7, 10, 14}},
    {"dim7", {0, 3, 6, 9, 12}},
    {"hdim7", {0, 3, 6, 10, 12}},
    {"minmaj7", {0, 3, 7, 11, 14}},
    {"maj6", {0, 4, 7, 9, 14}},
    {"min6", {0, 3, 7, 9, 14}},
    {"sus2", {0, 2, 7, 12, -1}},
    {"sus4", {0, 5, 7, 12, -1}},
    {"7sus4", {0, 5, 7, 10, 14}},
    {"9", {0, 4, 7, 10, 14}},
    {"maj9", {0, 4, 7, 11, 14}},
    {"min9", {0, 3, 7, 10, 14}},
    {"maj11", {0, 4, 7, 11, 14}},
    {"min11", {0, 3, 7, 10, 14}},
    {"13", {0, 4, 7, 10, 14}},
    {"maj13", {0, 4, 7, 11, 14}},
    {"min13", {0, 3, 7, 10, 14}},
    {"add9", {0, 4, 7, 14, -1}},
    {"6add9", {0, 4, 7, 9, 14}},
    {"madd9", {0, 3, 7, 14, -1}},
    {"m6add9", {0, 3, 7, 9, 14}},
    {"9sus4", {0, 5, 7, 10, 14}},
    {"7b5", {0, 4, 6, 10, 14}},
    {"7#5", {0, 4, 8, 10, 14}},
    {"7b9", {0, 4, 7, 10, 13}},
    {"7#9", {0, 4, 7, 10, 15}},
    {"7b5b9", {0, 4, 6, 10, 13}},
    {"7b5#9", {0, 4, 6, 10, 15}},
    {"7#5b9", {0, 4, 8, 10, 13}},
    {"7#5#9", {0, 4, 8, 10, 15}},
    {"11b9", {0, 4, 7, 10, 13}},
    {"11#9", {0, 4, 7, 10, 15}},
    {"13b9", {0, 4, 7, 10, 13}},
    {"7b9sus4", {0, 5, 7, 10, 13}},
    {"7#9sus4", {0, 5, 7, 10, 15}},
    {"7sus4b9", {0, 5, 7, 10, 13}},
    {"7sus4#9", {0, 5, 7, 10, 15}},
    {"7b5sus4", {0, 5, 6, 10, 14}},
    {"7#5sus4", {0, 5, 8, 10, 14}},   
    {"m7b5", {0, 3, 6, 10, 14}},
    {"m7#5", {0, 3, 8, 10, 14}},
    {"m7b5b9", {0, 3, 6, 10, 13}},
    {"m7b5#9", {0, 3, 6, 10, 15}},
    {"m7#5b9", {0, 3, 8, 10, 13}},
    {"m7#5#9", {0, 3, 8, 10, 15}},
    {"m11b9", {0, 3, 7, 10, 13}},
    {"m11#9", {0, 3, 7, 10, 15}},
    {"m13b9", {0, 3, 7, 10, 13}},
    {"m13#9", {0, 3, 7, 10, 15}},   
    {"m7b9sus4", {0, 5, 7, 10, 13}},
    {"m7#9sus4", {0, 5, 7, 10, 15}},
    {"m7sus4b9", {0, 5, 7, 10, 13}},
    {"m7sus4#9", {0, 5, 7, 10, 15}},   
    {"6", {0, 4, 7, 9, 14}},
    {"m6", {0, 3, 7, 9, 14}},
    {"6sus4", {0, 5, 7, 9, 14}},
    {"7sus4", {0, 5, 7, 10, 14}},    
    {"9sus4", {0, 5, 7, 10, 14}},
    {"9sus4b9", {0, 5, 7, 10, 13}},    
    {"maj7sus4", {0, 5, 7, 11, 14}},   
    {"m7sus4", {0, 5, 7, 10, 14}},
    {"m7sus4b9", {0, 5, 7, 10, 13}},
    {"m7sus4#9", {0, 5, 7, 10, 15}},
    {NULL, {0, 0, 0, 0, 0}},
};

// /* Modes */
mode_type mode_types[] = {
    {"ionian", {0, 2, 4, 5, 7, 9, 11}},
    {"dorian", {0, 2, 3, 5, 7, 9, 10}},
    {"phrygian", {0, 1, 3, 5, 7, 8, 10}},
    {"lydian", {0, 2, 4, 6, 7, 9, 11}},
    {"mixolydian", {0, 2, 4, 5, 7, 9, 10}},
    {"aeolian", {0, 2, 3, 5, 7, 8, 10}},
    {"locrian", {0, 1, 3, 5, 6, 8, 10}},
    {"major", {0, 2, 4, 5, 7, 9, 11}},
    {"minor", {0, 2, 3, 5, 7, 8, 10}},
    {"harmonic minor", {0, 2, 3, 5, 7, 8, 11}},
    {"melodic minor", {0, 2, 3, 5, 7, 9, 11}},      
    {NULL, {0, 0, 0, 0, 0, 0, 0}}, 
};